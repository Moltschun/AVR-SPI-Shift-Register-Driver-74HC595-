/*
 * main.c
 * Демонстрация работы SPI со сдвиговым регистром 74HC595.
 * Эффект: Бегущий огонь (Chaser Light).
 */

#include <avr/io.h>
#include <util/delay.h>
#include "spi.h"

int main(void) {
    // Инициализация SPI шины
    SPI_Init_Master();

    // Начальное состояние: горит только первый бит (0000 0001)
    uint8_t pattern = 0x01;

    while (1) {
        // --- Цикл обновления 74HC595 ---
        
        SPI_LATCH_LOW();        // 1. Открываем "ворота" (начало пакета)
        SPI_Transmit(pattern);  // 2. Заталкиваем байт в регистр
        SPI_LATCH_HIGH();       // 3. Закрываем "ворота" (вывод на светодиоды)

        // --- Логика анимации ---
        
        // Сдвиг бита влево (умножение на 2)
        pattern = pattern << 1; 

        // Если бит ушел за пределы байта (pattern стал 0),
        // возвращаем его в начало.
        if (pattern == 0) {
            pattern = 0x01;
        }

        // Задержка для восприятия глазом
        _delay_ms(100);
    }
}