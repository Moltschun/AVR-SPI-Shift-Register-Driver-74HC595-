/*
 * spi.h
 *
 * Библиотека для работы с аппаратным SPI на микроконтроллерах AVR (ATmega328p).
 * Адаптировано для управления сдвиговым регистром 74HC595.
 */

#ifndef SPI_H_
#define SPI_H_

#include <avr/io.h>

// --- Конфигурация пинов (Arduino Uno/Nano) ---
// SS (Slave Select) он же Latch (Защелка) для 74HC595.
// Если меняешь пин подключения, меняй его только здесь.
#define SPI_SS_PORT PORTB
#define SPI_SS_PIN  PB2   // Пин D10 на Arduino

// --- Макросы управления Защелкой (LATCH) ---

// Опустить защелку (Подготовка к приему данных)
// Используем &= ~ (И + НЕ), чтобы сбросить бит в 0, не трогая остальные.
#define SPI_LATCH_LOW()  (SPI_SS_PORT &= ~(1 << SPI_SS_PIN))

// Поднять защелку (Вывод данных на светодиоды)
// Используем |= (ИЛИ), чтобы установить бит в 1.
#define SPI_LATCH_HIGH() (SPI_SS_PORT |= (1 << SPI_SS_PIN))

/**
 * @brief Инициализация модуля SPI в режиме Master.
 * Настраивает MOSI, SCK, SS как выходы.
 * Устанавливает скорость передачи F_CPU / 16 (1 МГц).
 */
void SPI_Init_Master(void);

/**
 * @brief Отправка одного байта данных через SPI.
 * Функция блокирующая: ждет завершения передачи битов.
 * * @param data Байт данных (8 бит), который нужно отправить.
 */
void SPI_Transmit(uint8_t data);

#endif /* SPI_H_ */